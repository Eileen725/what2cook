{% extends "base.html" %}

{% block content %}
<div style="background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
  <h1>Rezeptsuche mit Zutaten</h1>
  <p style="color: #666; margin-top: 10px;">
    Gib Zutaten ein, die du zu Hause hast, und finde passende Rezepte!
  </p>
  
  <!-- Suchformular -->
  <form method="POST" style="margin-top: 30px;">
    <div class="form-group">
      <label for="zutaten">Welche Zutaten hast du?</label>
      <input type="text" 
             id="zutaten" 
             name="zutaten" 
             class="form-control" 
             placeholder="z.B. Tomaten, Pasta, Käse (getrennt durch Komma)"
             value="{{ suchbegriffe }}"
             style="font-size: 16px; padding: 12px;"
             autofocus>
      <p class="help-block">Trenne mehrere Zutaten mit Komma. Drücke Enter zum Suchen.</p>
    </div>
    <button type="submit" class="btn btn-primary btn-lg">Rezepte finden</button>
  </form>

  <!-- Ergebnisse -->
  {% if suchbegriffe %}
    <hr style="margin: 40px 0;">
    
    {% if rezepte %}
      <h3>Passende Rezepte ({{ rezepte|length }})</h3>
      <p style="color: #666;">Sortiert nach Anzahl vorhandener Zutaten</p>
      
      <div style="margin-top: 20px;">
        {% for rezept in rezepte %}
          <div style="background: #f9f9f9; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <!-- Rezepttitel und Prozent -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <h4 style="margin: 0; color: #333;">{{ rezept.name }}</h4>
              <span style="background: #ff9800; color: white; padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 14px;">
                {{ rezept.vorhanden_count }}/{{ rezept.total_count }} Zutaten ({{ rezept.prozent }}%)
              </span>
            </div>
            
            <p style="color: #666; font-style: italic; margin-bottom: 15px;">{{ rezept.description }}</p>
            
            <!-- Vorhandene Zutaten -->
            <div style="margin-bottom: 15px;">
              <strong style="color: #4caf50;">✓ Vorhandene Zutaten ({{ rezept.vorhanden_count }})</strong>
              <ul style="margin: 5px 0 0 20px; padding: 0;">
                {% for zutat in rezept.vorhandene_zutaten %}
                  <li style="color: #4caf50;">
                    {{ zutat.name }}
                    {% if zutat.number %}{{ zutat.number }}{% endif %}
                    {% if zutat.einheit %} {{ zutat.einheit }}{% endif %}
                  </li>
                {% endfor %}
              </ul>
            </div>
            
            <!-- Fehlende Zutaten (Einkaufsliste) -->
            {% if rezept.fehlende_zutaten %}
            <div style="margin-bottom: 15px;">
              <strong style="color: #f44336;">Einkaufsliste ({{ rezept.fehlende_zutaten|length }})</strong>
              <ul style="margin: 5px 0 0 20px; padding: 0;">
                {% for zutat in rezept.fehlende_zutaten %}
                  <li style="color: #f44336;">
                    ✗ {{ zutat.name }}
                    {% if zutat.number %}{{ zutat.number }}{% endif %}
                    {% if zutat.einheit %} {{ zutat.einheit }}{% endif %}
                  </li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            
            <a href="{{ url_for('rezept_detail', rezept_id=rezept.id) }}" class="btn btn-primary">
              Zum Rezept
            </a>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div style="text-align: center; padding: 40px; background-color: #fff3cd; border-radius: 8px; border: 1px solid #ffc107;">
        <h3 style="color: #856404;">Keine Rezepte gefunden</h3>
        <p style="color: #856404; margin-top: 10px;">
          Mit den Zutaten "{{ suchbegriffe }}" wurde leider kein Rezept gefunden.
        </p>
        <p style="color: #856404;">
          Versuche es mit anderen Zutaten oder füge neue Rezepte hinzu!
        </p>
      </div>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
